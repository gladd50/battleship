(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const o of d)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function h(d){const o={};return d.integrity&&(o.integrity=d.integrity),d.referrerPolicy&&(o.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?o.credentials="include":d.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(d){if(d.ep)return;d.ep=!0;const o=h(d);fetch(d.href,o)}})();const V=r=>({len:r,hitted:0,hit:function(){this.hitted+=1},isSunk:function(){return this.len===this.hitted}}),W=()=>{const r=[];let p=0;for(let t=0;t<10;t++){r[t]=[];for(let e=0;e<10;e++)r[t].push("0")}const h=(t,e,a,u,c)=>{a==="v"?((u===-1||u===-2)&&t>=0&&t<10&&(r[t][e]="W",c.push({row:t,col:e})),e-1>=0&&t>=0&&t<10&&(r[t][e-1]="W",c.push({row:t,col:e-1})),e+1<10&&t>=0&&t<10&&(r[t][e+1]="W",c.push({row:t,col:e+1}))):a==="h"&&((u===-1||u===-2)&&e>=0&&e<10&&(r[t][e]="W",c.push({row:t,col:e})),t-1>=0&&e>=0&&e<10&&(r[t-1][e]="W",c.push({row:t-1,col:e})),t+1<10&&e>=0&&e<10&&(r[t+1][e]="W",c.push({row:t+1,col:e})))},l=(t,e,a,u,c=!1,b=null)=>{if(u==="h"&&e+a>10)return 0;if(u==="v"&&t+a>10)return 0;for(let n=e;n<e+a;n++)if(u==="h"&&r[t][n]!=="0")return 0;for(let n=t;n<t+a;n++)if(u==="v"&&r[n][e]!=="0")return 0;if(c){if(u==="h")for(let n=e;n<e+a;n++)b[t][n]="Q";else if(u==="v")for(let n=t;n<t+a;n++)b[n][e]="Q";return!0}let B=V(a),A=0,k=[];const P=[];if(u==="h")for(let n=e;n<e+a;n++)A===0&&h(t,n-1,u,-1,k),A===a-1&&h(t,n+1,u,-2,k),r[t][n]={ship:B,isHit:!1},P.push({row:t,col:n}),h(t,n,u,A,k),A++;else if(u==="v")for(let n=t;n<t+a;n++)A===0&&h(n-1,e,u,-1,k),A===a-1&&h(n+1,e,u,-2,k),r[n][e]={ship:B,isHit:!1},P.push({row:n,col:e}),h(n,e,u,A,k),A++;return B.aroundPos=k,p++,{shipPos:P,aroundPos:k}},d=(t,e)=>{const a=r[t][e].ship.aroundPos;for(let u=0;u<a.length;u++)r[a[u].row][a[u].col]="X";return a};return{board:r,countShip:()=>p,availableTiles:(t,e)=>{let a=[],u=JSON.parse(JSON.stringify(r));for(let c=0;c<10;c++)for(let b=0;b<10;b++)l(c,b,t,e,!0,u)!==0&&a.push({row:c,col:b});return a},placeShip:l,receiveAttack:(t,e)=>r[t][e]==="X"||typeof r[t][e]=="object"&&r[t][e].isHit?"illegal":typeof r[t][e]=="object"&&r[t][e].ship?(r[t][e].isHit=!0,r[t][e].ship.hit(),r[t][e].ship.isSunk()?d(t,e):"hit a ship"):(r[t][e]="X","miss"),isOver:()=>{for(let t=0;t<10;t++)for(let e=0;e<10;e++)if(typeof r[t][e]=="object"&&!r[t][e].ship.isSunk())return!1;return!0},resetBoard:()=>{for(let t=0;t<10;t++)for(let e=0;e<10;e++)r[t][e]="0"}}},i=W(),N=W(),Z=r=>({attack:(h,l)=>r.receiveAttack(h,l)}),Q=r=>({createFleet:(h,l,d,o)=>r.placeShip(h,l,d,o)}),X=r=>({randomFleet:h=>{let l=[];return h.forEach(d=>{const o=Math.floor(Math.random()*2)===1?"h":"v",m=r.availableTiles(d,o),y=Math.floor(Math.random()*m.length);l.push(r.placeShip(m[y].row,m[y].col,d,o))}),l}}),_=()=>{let r=!0;return{gb:i,getTurn:()=>r,changeTurn:()=>(r=!r,r),...Z(N),...Q(i),...X(i)}},ee=()=>{let r=!1;const p=()=>(r=!r,r),h=()=>r;let l=[];return{gb:N,attack:()=>{const o=["hit"];if(l.length>0){const s=l.pop(),t=i.receiveAttack(s.row,s.col);if(o.push({row:s.row,col:s.col}),typeof i.board[s.row][s.col]=="object"&&i.board[s.row][s.col].ship.isSunk())return l=[],{around:i.board[s.row][s.col].ship.aroundPos,hit:o};if(t!=="hit a ship")return o;const e=i.board[s.row][s.col].ship.len;for(let a=1;a<=e-2;a++){if(s.dir==="down"){const u=i.receiveAttack(s.row+a,s.col);if(o.push({row:s.row+a,col:s.col}),typeof i.board[s.row+a][s.col]=="object"&&i.board[s.row+a][s.col].ship.isSunk())return l=[],{around:i.board[s.row+a][s.col].ship.aroundPos,hit:o};if(u!=="hit a ship")return o}if(s.dir==="up"){const u=i.receiveAttack(s.row-a,s.col);if(o.push({row:s.row-a,col:s.col}),typeof i.board[s.row-a][s.col]=="object"&&i.board[s.row-a][s.col].ship.isSunk())return l=[],{around:i.board[s.row-a][s.col].ship.aroundPos,hit:o};if(u!=="hit a ship")return o}if(s.dir==="right"){const u=i.receiveAttack(s.row,s.col+a);if(o.push({row:s.row,col:s.col+a}),typeof i.board[s.row][s.col+a]=="object"&&i.board[s.row][s.col+a].ship.isSunk())return l=[],{around:i.board[s.row][s.col+a].ship.aroundPos,hit:o};if(u!=="hit a ship")return o}if(s.dir==="left"){const u=i.receiveAttack(s.row,s.col-a);if(o.push({row:s.row,col:s.col-a}),typeof i.board[s.row][s.col-a]=="object"&&i.board[s.row][s.col-a].ship.isSunk())return l=[],{around:i.board[s.row][s.col-a].ship.aroundPos,hit:o};if(u!=="hit a ship")return o}}}let m=[];for(let s=0;s<10;s++)for(let t=0;t<10;t++)i.board[s][t]!=="X"&&!i.board[s][t].isHit&&m.push({row:s,col:t});if(m.length===0)return"no available attack";const y=m[Math.floor(Math.random()*m.length)],g=i.receiveAttack(y.row,y.col);if(o.push({row:y.row,col:y.col}),g==="hit a ship"&&!i.board[y.row][y.col].ship.isSunk()){const{row:s,col:t}=y;s+1<10&&l.push({row:s+1,col:t,dir:"down"}),s-1>=0&&l.push({row:s-1,col:t,dir:"up"}),t+1<10&&l.push({row:s,col:t+1,dir:"right"}),t-1>=0&&l.push({row:s,col:t-1,dir:"left"});const e=l.pop(),a=i.receiveAttack(e.row,e.col);if(o.push({row:e.row,col:e.col}),typeof i.board[e.row][e.col]=="object"&&i.board[e.row][e.col].ship.isSunk())return l=[],{around:i.board[e.row][e.col].ship.aroundPos,hit:o};if(a!=="hit a ship")return o;const u=i.board[e.row][e.col].ship.len;for(let c=1;c<=u-2;c++){if(e.dir==="down"){const b=i.receiveAttack(e.row+c,e.col);if(o.push({row:e.row+c,col:e.col}),typeof i.board[e.row+c][e.col]=="object"&&i.board[e.row+c][e.col].ship.isSunk())return l=[],{around:i.board[e.row+c][e.col].ship.aroundPos,hit:o};if(b!=="hit a ship")return o}if(e.dir==="up"){const b=i.receiveAttack(e.row-c,e.col);if(o.push({row:e.row-c,col:e.col}),typeof i.board[e.row-c][e.col]=="object"&&i.board[e.row-c][e.col].ship.isSunk())return l=[],{around:i.board[e.row-c][e.col].ship.aroundPos,hit:o};if(b!=="hit a ship")return o}if(e.dir==="right"){const b=i.receiveAttack(e.row,e.col+c);if(o.push({row:e.row,col:e.col+c}),typeof i.board[e.row][e.col+c]=="object"&&i.board[e.row][e.col+c].ship.isSunk())return l=[],{around:i.board[e.row][e.col+c].ship.aroundPos,hit:o};if(b!=="hit a ship")return o}if(e.dir==="left"){const b=i.receiveAttack(e.row,e.col-c);if(o.push({row:e.row,col:e.col-c}),typeof i.board[e.row][e.col-c]=="object"&&i.board[e.row][e.col-c].ship.isSunk())return l=[],{around:i.board[e.row][e.col-c].ship.aroundPos,hit:o};if(b!=="hit a ship")return o}}}return o},getTurn:h,changeTurn:p,...Q(N),...X(N)}},H=_(),j=ee(),G=[5,4,3,2,2],te=()=>(j.randomFleet(G),{isAllowed:()=>H.gb.countShip()===5?"ready":"not ready"}),se=(r,p)=>{const h={player:{around:null},enemy:{hit:null,around:null}},l=()=>{H.changeTurn(),j.changeTurn()},d=H.attack(r,p);if(d==="illegal")return d;if(d==="hit a ship")return h;typeof d=="object"&&(h.player.around=d),l();const o=j.attack();return Array.isArray(o)&&o[0]==="hit"?h.enemy.hit=o:(h.enemy.around=o.around,h.enemy.hit=o.hit),l(),h},F={youBoard:document.querySelector("#you-board"),enemyBoard:document.querySelector("#enemy-board"),getYouTiles:()=>document.querySelectorAll(".you-tile"),getEnemyTiles:()=>document.querySelectorAll(".enemy-tile"),tiles:document.querySelectorAll(".tile"),tempShipCont:document.querySelector(".ship-temp-cont"),tempShips:document.querySelectorAll(".ship-temp"),getTempShip:()=>document.querySelector(".ship-temp"),shipName:document.querySelector(".ship-name"),startBtn:document.querySelector(".start-btn"),randomBtn:document.querySelector("#random-btn"),resetBtn:document.querySelector("#reset-btn"),yourName:document.querySelector(".you > h2"),enemyName:document.querySelector(".enemy > h2")},$=[{name:"Patrol Boat",len:2},{name:"Submarine",len:3},{name:"Destroyer",len:3},{name:"Battleship",len:4}],oe=()=>{const{youBoard:r,enemyBoard:p}=F,h=(l,d)=>{const o=new DocumentFragment;for(let m=0;m<10;m++)for(let y=0;y<10;y++){const g=document.createElement("div");g.classList.add("tile"),g.dataset.row=m,g.dataset.col=y,g.classList.add(`${d}-tile`),o.append(g)}l.append(o)};h(r,"you"),h(p,"enemy")},re=()=>{oe();let r=[...$];const{tempShipCont:p,tempShips:h,getYouTiles:l,getEnemyTiles:d,getTempShip:o,shipName:m,startBtn:y,randomBtn:g,resetBtn:s,youBoard:t,yourName:e,enemyBoard:a,enemyName:u}=F,c=()=>{p.style.display==="block"?(p.style.display="flex",p.firstElementChild.dataset.dir="h"):(p.style.display="block",p.firstElementChild.dataset.dir="v")};h.forEach(w=>{w.addEventListener("click",c)});const b=l(),B=d(),A=w=>{w.preventDefault()},k=()=>{for(;p.firstElementChild;)p.removeChild(p.firstElementChild)},P=w=>{for(let f=0;f<w.length;f++){const{row:R,col:T}=w[f],q=`.you-tile[data-row="${R}"][data-col="${T}"]`;document.querySelector(q).classList.add("ship")}},n=w=>{for(let f=0;f<w.length;f++){const{row:R,col:T}=w[f],q=`.you-tile[data-row="${R}"][data-col="${T}"]`,D=document.querySelector(q);D.classList.add("around"),D.classList.add("around-show")}},v=()=>{y.classList.add("hide")},L=()=>{y.classList.remove("hide")},E=w=>{w.preventDefault();const f=o(),R={dir:f.dataset.dir,len:parseInt(f.dataset.len,10)},T={row:parseInt(w.target.dataset.row,10),col:parseInt(w.target.dataset.col,10)},{dir:q,len:D}=R,{row:z,col:J}=T,{shipPos:I,aroundPos:K}=H.createFleet(z,J,D,q),U=()=>{const O=r.pop();if(O)for(let M=0;M<O.len;M++){const C=document.createElement("div");C.classList.add("ship-temp"),C.dataset.dir=R.dir,C.dataset.len=O.len,m.textContent=O.name,C.addEventListener("click",c),p.append(C)}else m.textContent=""};I&&(k(),U(),P(I),n(K)),m.textContent===""&&L()};b.forEach(w=>{w.addEventListener("dragover",f=>A(f)),w.addEventListener("drop",f=>E(f))});const S=()=>{t.classList.remove("lose"),a.classList.remove("win"),u.classList.remove("turn"),e.classList.remove("turn"),a.classList.add("disable")},x=w=>{H.gb.resetBoard(),j.gb.resetBoard(),S(),b.forEach(f=>{f.classList.remove("ship"),f.classList.remove("around"),f.classList.remove("around-show"),f.classList.remove("miss"),f.classList.remove("hit")}),B.forEach(f=>{f.classList.remove("ship"),f.classList.remove("ship-enemy"),f.classList.remove("around"),f.classList.remove("around-show"),f.classList.remove("miss"),f.classList.remove("hit")}),k(),r=[...$],m.textContent="",g.classList.remove("hide"),w!=="random"&&(v(),(()=>{for(let R=0;R<5;R++){const T=document.createElement("div");T.classList.add("ship-temp"),T.dataset.dir="h",T.dataset.len=5,m.textContent="Carrier",T.addEventListener("click",c),p.append(T)}})(),p.style.display="flex")},Y=()=>{x("random"),H.randomFleet(G).forEach(f=>{const{shipPos:R,aroundPos:T}=f;P(R),n(T)}),L()};s.addEventListener("click",()=>x("not random")),g.addEventListener("click",Y)},ne=()=>{const{startBtn:r,randomBtn:p,enemyBoard:h,youBoard:l,yourName:d,enemyName:o,getYouTiles:m,getEnemyTiles:y}=F,g=m(),s=y(),t=(n,v,L)=>document.querySelector(`.${L}-tile[data-row="${n}"][data-col="${v}"]`),e=()=>{const n=j.gb.board;for(let v=0;v<10;v++)for(let L=0;L<10;L++){const E=t(v,L,"enemy");typeof n[v][L]=="object"&&E.classList.add("ship-enemy")}},a=()=>{r.classList.add("hide"),p.classList.add("hide")},u=()=>{g.forEach(n=>{n.classList.contains("around-show")&&n.classList.remove("around-show")})},c=n=>new Promise(v=>setTimeout(v,n)),b=n=>{n.classList.contains("ship-enemy")?n.classList.add("hit"):n.classList.add("miss")},B=async(n,v)=>{for(const L of n){const{row:E,col:S}=L,x=t(E,S,v);x.classList.contains("miss")&&x.classList.remove("miss"),x.classList.add("around-animation"),await c(100),x.classList.remove("around-animation"),x.classList.add("around-show")}},A=async n=>{for(const v of n){if(v==="hit")continue;const{row:L,col:E}=v,S=t(L,E,"you");await c(500),S.classList.contains("ship")?S.classList.add("hit"):S.classList.add("miss")}},k=async n=>{const v=n.target.dataset.row,L=n.target.dataset.col,E=n.target,S=se(v,L);if(S!=="illegal"){if(b(E),S.player.around&&(h.classList.add("disable"),await B(S.player.around,"enemy")),j.gb.isOver()){h.classList.add("lose"),l.classList.add("win"),h.classList.add("disable"),o.classList.remove("turn"),d.classList.remove("turn");return}if(h.classList.add("disable"),S.enemy.hit&&(o.classList.remove("turn"),d.classList.add("turn"),await A(S.enemy.hit),o.classList.add("turn"),d.classList.remove("turn")),S.enemy.around&&(d.classList.add("turn"),o.classList.remove("turn"),await B(S.enemy.around,"you"),o.classList.add("turn"),d.classList.remove("turn")),H.gb.isOver()){l.classList.add("lose"),h.classList.add("win"),h.classList.add("disable"),o.classList.remove("turn"),d.classList.remove("turn");return}h.classList.remove("disable")}},P=()=>{te(),u(),a(),e(),o.classList.add("turn"),h.classList.remove("disable"),s.forEach(n=>{n.addEventListener("click",v=>k(v))})};r.addEventListener("click",P)};re();ne();
